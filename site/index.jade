mixin field-check(id, label)
  .field-check
    label(for=id) #{label}
    input(type='checkbox', id=id)
    block

mixin field-text(id, label)
  .field-text
    label(for=id) #{label}
    input(type='text', id=id)
    block

mixin help
  span.help.closed
    span.closed
      |  [
      span.help-btn explain
      |] 
    span.open
      |  [
      span.help-btn hide
      |] 
      .help-text
        block

html
  head
    title Fishing line experiment calculator
    link(rel='stylesheet', href='app.css')
    script(src='lib-3p/ASCIIMathML.js')
    script(src='lib-3p/zepto.min.js')
    script(src='lib-3p/query-string.js')
body
  :md
    # Fishing Line Experiment Calculator
    To view this page properly please use a browser that supports
    [MathML](https://www.w3.org/Math/) such as Firefox.
    Bug reports and suggestions can be added to the [issues log](https://github.com/dizzib/flx-calc/issues).
    The source code is freely [available on GitHub.com](https://github.com/dizzib/flx-calc).
  fieldset
    legend Line properties at zero tension `T_0`
    +field-text('l_s', 'sample length `l_s` = ')
      | m. The length of line used to calculate the line density 
    +field-text('m_s', 'sample mass `m_s` = ')
      | g.
    +field-text('d', 'diameter `d` = ')
      | mm.
    +field-text('nu', 'Poisson ratio `nu` = ')
      | . This determines how much the diameter changes when tension is applied.
  fieldset
    legend Apparatus setup
    +field-text('x', 'pole span `x` = ')
      | m. The distance between the two poles (the depth meters at each end).
    +field-text('l_o', 'outer line length `l_o` = ')
      | m.
      +help
        | The line length from the anchor to pole A plus the unstretched line length
        | from pole B to an indicator on the line.
    +field-check('nb', 'Calibrate the water density to make the line neutrally buoyant?')
    +field-text('rho_w', 'water density `rho_w` = ')
      | kg/`m^3`. This is a function of temperature [
      a(href="http://www.csgnetwork.com/waterinformation.html") table
      | ].
  fieldset
    legend Measurements at maximum tension `T_max`
    +field-text('T_max', 'line tension `T_max` = ')
      | N
    +field-text('dl', 'line stretch `Delta l` = ')
      | m. How far the indicator moves when `T_max` is applied.
    +field-text('uy', 'water/line level reading uncertainty `+-deltay` = ')
      | mm.
      +help
        | A skillful experimenter using a ruler with 1mm gradations 
        a(href='https://youtu.be/uZ0ILIG_l7w') should be able to estimate
        |  to within &plusmn; 0.1mm.
        | However, this figure is somewhat subjective and may increase with
        | difficulties such as parallax, lack of magnification, the clarity/focus of
        | the water/line, whether the ruler is part obscured, etc.
    +field-text('v', 'control line vertical drift velocity `v` = ')
      | mm/min.
      +help
        | A slow vertical drift of the control line indicates a prevailing
        | current and/or mis-calibration of the water density.
        | Enter a -ve number for upward drift or +ve for downward.
  fieldset
    legend Calculated conditions at line's midpoint
    .out
      label line sag = 
      span.bold#sag
      |  mm (
      span#sag_dl
      |  mm due to stretch, 
      span#sag_v
      |  mm due to prevailing current or mis-calibration)
    .out
      label water height difference due to earth's curvature `Delta h` = &plusmn; 
      span.bold#dh
      |  mm
    .out
      label predicted line depth difference of concave `DeltaY_(conc)` = 
      span#dY_concave
      |  mm, flat `DeltaY_(flat)` = 
      span#dY_flat
      |  mm, convex `DeltaY_(conv)` = 
      span#dY_convex
      |  mm
    .out
      label standard deviation of outliers `sigma_o` = 
      span#sigma_o
      |  mm.
      +help
        | A threshold beyond which a set of measurements might contain 
        a(href='https://en.wikipedia.org/wiki/Outlier') outliers
        | . For example, given a set of measurements of `DeltaY` 
        a(href='https://en.wikipedia.org/wiki/Normal_distribution') normally distributed
        |  with average `DeltaY_(conc)`, if `sigma < sigma_o` then every
        | measurement will be lying closer to `DeltaY_(conc)` than `DeltaY_(flat)`.
        | If `sigma > sigma_o` then some measurements might be outlying
        | closer to `DeltaY_(flat)`.
    .out
      label standard deviation of reading errors `sigma_u` = 
      span#sigma_u
      |  mm = 
      span.bold#sigma_u-perc
      |  % of `sigma_o`.
      +help
        | The expected SD caused by water/line level reading
        | errors in a set of measurements of `DeltaY`.
        | The % is a guide as to whether the reading precision is good
        | enough for the given pole span.
        | A value < 50% sufficiently allows for other random errors, whereas
        | a value > 100% means other random errors will start producing
        | outliers.
  fieldset
    legend Calculated line properties
    .out
      label density at `T_0` = 
      span#rho_l
      |  kg/`m^3`, at `T_max` = 
      span#rho_lT
      |  kg/`m^3`.
    .out
      label diameter change `Delta d` = 
      span#dd
      |  mm [
      a(href="https://en.wikipedia.org/wiki/Poisson's_ratio#Width_change") equation
      | ]
    .out
      label Young's modulus `E` = 
      span#E
      |  GPa [
      a(href="http://physicsnet.co.uk/a-level-physics-as-a2/materials/young-modulus/") equation
      | ]
    .out
      label Reynolds number `Re` = 
      span#re
      +help
        | Calculated as `(v d_T) / nu` where `v` is the drift velocity,
        | `d_T` is the line diameter at `T_max`
        | and `nu` is the kinematic viscosity of water.
        | A value < 1 indicates laminar flow.
    .out
      label drag coefficient `c_d` = 
      span#c_d
      +help
        | Calculated using the Oseen approximation by Lamb:
        | `c_d = (8 pi) / (Re (2.002 - ln Re))`.
        span.bold Note this is valid only when `Re < 1`.

  script(src='calc.js')
  script(src='app.js')
